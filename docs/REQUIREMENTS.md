# Требования к MR Description Generator

## Функциональные требования

### Основная функциональность
1. **Автоматическая генерация описаний Merge Request**
   - Анализ git diff между базовой веткой и целевой веткой
   - Генерация структурированного описания изменений на русском языке
   - Поддержка различных форматов вывода (консоль, файл)

2. **Поддержка множественных ИИ провайдеров**
   - GigaChat API (Сбер)
   - DeepSeek API
   - Модульная архитектура для добавления новых провайдеров

3. **Умная обработка больших diff'ов**
   - Автоматическое сжатие diff'ов превышающих лимиты API
   - Сохранение ключевой информации при сжатии
   - Удаление избыточных данных (пустые строки, повторения)

4. **Автоматическое определение типа изменений**
   - **Feature** - новые функции и возможности
   - **Bugfix** - исправления ошибок
   - **Refactor** - рефакторинг кода без изменения функциональности
   - **Infrastructure** - CI/CD, конфигурация, деплой
   - **Default** - смешанные изменения

### CLI интерфейс
1. **Обязательные параметры**
   - `--repo-path` - путь к Git репозиторию
   - `--provider` - выбор ИИ провайдера

2. **Опциональные параметры**
   - `--branch` - целевая ветка (по умолчанию: текущая)
   - `--base-branch` - базовая ветка (по умолчанию: main/master)
   - `--output` - файл для сохранения результата
   - `--language` - язык описания (ru/en)
   - `--dry-run` - показ diff без генерации
   - `--api-key` - API ключ (альтернатива .env)
   - `--temperature` - температура генерации
   - `--max-tokens` - максимальное количество токенов

## Технические требования

### Архитектура
1. **Модульная структура**
   - Абстрактный базовый класс `LLMProvider`
   - Конкретные реализации для каждого провайдера
   - Отдельные модули для Git операций и конфигурации

2. **Обработка ошибок**
   - Graceful handling API ошибок
   - Информативные сообщения об ошибках
   - Retry механизм для сетевых запросов

3. **Конфигурация**
   - Поддержка `.env` файлов для API ключей
   - Конфигурационные файлы для настроек провайдеров
   - Переменные окружения как fallback

### Производительность
1. **Оптимизация запросов**
   - Умное сжатие diff'ов до 85% от исходного размера
   - Избежание ошибок 422 (Unprocessable Entity)
   - Кэширование результатов git операций

2. **Обработка больших репозиториев**
   - Поддержка diff'ов размером 200,000+ символов
   - Фокус на ключевых изменениях
   - Пропуск бинарных файлов и автогенерированного кода

### Качество описаний
1. **Специализированные промпты**
   - Уникальные стили описания для каждого типа MR
   - Технические детали без "воды"
   - Структурированный формат вывода

2. **Контекстная информация**
   - Количество измененных файлов
   - Количество коммитов
   - Статистика изменений (добавления/удаления)

## Требования к интеграции

### Git интеграция
1. **Поддержка Git операций**
   - Определение текущей ветки
   - Получение diff между ветками
   - Обработка удаленных веток
   - Валидация существования веток

2. **Совместимость**
   - Работа с локальными и удаленными репозиториями
   - Поддержка различных Git workflow
   - Обработка merge conflicts

### API интеграция
1. **GigaChat API**
   - Аутентификация через Client ID/Secret
   - Обработка специфичных заголовков (RqUID)
   - Соответствие лимитам API

2. **DeepSeek API**
   - Аутентификация через API Key
   - Обработка rate limiting
   - Соответствие формату OpenAI API

## Требования к качеству

### Тестирование
1. **Unit тесты**
   - Покрытие основных модулей
   - Мокирование внешних зависимостей
   - Тестирование edge cases

2. **Integration тесты**
   - Тестирование на реальных репозиториях
   - Проверка работы с различными типами изменений
   - Валидация качества генерируемых описаний

### Документация
1. **Пользовательская документация**
   - README с quick start guide
   - Примеры использования
   - Troubleshooting guide

2. **Техническая документация**
   - Архитектура системы
   - API провайдеров
   - Алгоритмы обработки diff'ов

## Требования к развертыванию

### Зависимости
1. **Python требования**
   - Python 3.8+
   - Стандартные библиотеки: requests, argparse
   - Опциональные: gitpython, rich, pydantic

2. **Системные требования**
   - Git CLI
   - Интернет соединение для API запросов
   - Unix-like система (macOS, Linux)

### Установка и настройка
1. **Простая установка**
   - `pip install -r requirements.txt`
   - Копирование .env.example в .env
   - Заполнение API ключей

2. **Готовые скрипты**
   - Makefile для автоматизации
   - Скрипты для быстрого тестирования
   - Валидация настроек

## Критерии приемки

### Функциональные критерии
- ✅ Генерация описаний для различных типов изменений
- ✅ Работа с diff'ами размером 200,000+ символов
- ✅ Сжатие до 40,000-50,000 символов без потери смысла
- ✅ Поддержка GigaChat и DeepSeek API
- ✅ CLI интерфейс со всеми указанными параметрами

### Качественные критерии
- ✅ Описания без "воды" и общих фраз
- ✅ Структурированный технический формат
- ✅ Корректное определение типа изменений в 90%+ случаев
- ✅ Время генерации не более 30 секунд для больших diff'ов

### Надежность
- ✅ Обработка ошибок API без падения приложения
- ✅ Информативные сообщения об ошибках
- ✅ Работа с различными структурами Git репозиториев
- ✅ Graceful fallback при недоступности API

## Будущие улучшения

### Планируемые возможности
1. **Дополнительные ИИ провайдеры**
   - OpenAI GPT-4
   - Anthropic Claude
   - Локальные LLM модели

2. **Интеграции**
   - GitLab MR API
   - GitHub PR API
   - Jira ticket linking

3. **Улучшения UX**
   - Web интерфейс
   - VS Code расширение
   - Git hooks интеграция

### Оптимизации
1. **Производительность**
   - Параллельная обработка файлов
   - Кэширование API ответов
   - Incremental diff processing

2. **Качество**
   - ML модель для классификации изменений
   - Contextual awareness для проектов
   - Template система для различных проектов
